.ORIG X3000


AND R1 R1 #0		; CLEARS R1, VALUE COUNTER
LD R0 X      		; R0 = X4005



COUNTER			; COUNTER LOOP
	LDR R3, R0, #0  ; PUT VALUE AT X INTO R3
	LD R7, Y
	AND R7, R3, R7  ; CHECK IF NON ZERO
	BRZ ENDCOUNTER  ; END THE COUNT IF ZERO
	ADD R0, R0, #1  ; INCREMENT TO FIND NEXT ADDRESS
	ADD R1, R1, #1  ; COUNTER
	BRP COUNTER	; GO BACK TO COUNTER

ENDCOUNTER
	ADD R1, R1, #-1	; DONT MESS WITH LAST 00
	ST R1, R	; STORE R1 INTO MEMORY
	LD R6, MASK1
	LD R7, Y	;BITMASKS

			; CAN STILL USE R4, R5, R6, R2, R7
FIRSTLOOP
	LD R1, R	; PULL R1
	ADD R1, R1, #-1	; COUNT-1
	ST R1, R	; UPDATE NEW R1
	BRNZ SORTED    	; DONE WITH SORTING
	ADD R2, R1, #0 	; R2 FOR SECOND LOOP
	LD R3, X	; PUT X4005 IN 43

SECONDLOOP
	LD R6, MASK1	; LOAD BITMASK TO USE
	LD R7, Y
	LDR R0, R3, #0	; R0= IDSC
	LDR R4, R3, #1	; R4= IDSC
	AND R1, R0, R6	; R1= ID00
	AND R0, R0, R7	; R0= 00SC
	AND R6, R4, R6	; R6= ID00
	AND R4, R4, R7	; R4= 00SC
	NOT R5, R4
	ADD R5, R5, #1	; R5 = -R4
	ADD R5, R5, R0	; R5= R0-R4
	BRZP SWAPPED	; IF POSITIVE, ALREADY SWAPPED
	;AND R4, R4, R7	; R4= 00R4
	;AND R0, R0, R7	; R0= 00R0
	ADD R4, R6, R4	; R4= IDSC
	ADD R0, R1, R0	; R0= IDSC
	STR R4, R3, #0	
	STR R0, R3, #1	; STORE BOTH ID AND SC
SWAPPED 
	ADD R3, R3, #1	; add values from 4005
	ADD R2, R2, #-1	; 
	BRP SECONDLOOP
	BRNZ FIRSTLOOP


SORTED	

LD R5, X
AND R0, R0, 0
AND R1, R1, 0
AND R2, R2, 0
AND R3, R3, 0
AND R4, R4, 0
HISTOGRAM
	LDR R7, R5, 0
	LD R6, MASK1
	AND R6, R7, R6
	BRZ DONE
	LD R6, Y
	AND R7, R7, R6
	ADD R5, R5, 1
	LD R6, AC
	ADD R6, R6, R7
	BRP ACOUNTER
	LD R6, BC
	ADD R6, R6, R7
	BRP BCOUNTER
	LD R6, CC
	ADD R6, R6, R7
	BRP CCOUNTER
	LD R6, DC
	ADD R6, R6, R7
	BRP DCOUNTER
	ADD R4, R4, 1
	BRNZP HISTOGRAM

ACOUNTER
	ADD R0, R0, 1
	BRNZP HISTOGRAM
BCOUNTER
	ADD R1, R1, 1
	BRNZP HISTOGRAM
CCOUNTER
	ADD R2, R2, 1
	BRNZP HISTOGRAM
DCOUNTER
	ADD R3, R3, 1
	BRNZP HISTOGRAM

DONE 
	LD R7, Z
	LD R6, A
	ADD R6, R0, R6
	STR R6, R7, 4
	LD R6, B
	ADD R6, R1, R6
	STR R6, R7, 3
	LD R6, C
	ADD R6, R2, R6
	STR R6, R7, 2
	LD R6, D
	ADD R6, R3, R6
	STR R6, R7, 1
	LD R6, F
	ADD R6, R4, R6
	STR R6, R7, 0

HALT
X .FILL X4005
Y .FILL X00FF
MASK1 .FILL XFF00
Z .FILL X4000
A .FILL X4100
B .FILL X4200
C .FILL X4300
D .FILL X4400
F .FILL X4600	
AC .FILL XFFB0
BC .FILL XFFC4
CC .FILL XFFD8
DC .FILL XFFEC
R .FILL X0000
.END


